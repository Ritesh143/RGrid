<div class="logout">
    <p><i class="fa fa-user"></i> {{userInfo.username}}</p>
    <button type='button' class="btn btn-md btn-outline-success" (click)="logout()">
        <i class="fa fa-sign-out"></i> Logout</button>
</div>
<div class="container container-background">
    <div class="row">
        <div class="col-sm-12">
            <span *ngIf="currentRoute === 'new'">
                <h1><i class="zmdi zmdi-plus"></i> Create A New Poll</h1>
            </span>
            <span *ngIf="currentRoute === 'edit'">
                <h1><i class="zmdi zmdi-floppy"></i> Add Poll Options</h1>
            </span>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6 vertical-center">
            <form class="border-setting" [formGroup]="fbForm" novalidate (ngSubmit)="save(fbForm)">

                <div class="form-group">
                    <textarea rows="2" class="form-control" formControlName="question"
                        placeholder="Question"></textarea>
                    <small class="text-danger" [hidden]="fbForm.controls.question.valid
                   || (fbForm.controls.question.pristine)">
                        Question is required (minimum 6 characters).
                    </small>
                </div>
                <!-- 
                <div *ngIf="currentRoute === 'edit'">
                    <div *ngFor="let option of staticOptions">
                        <div class="form-group">
                            <input type="text" class="form-inline form-control" value="{{option}}" disabled>
                        </div>
                    </div>
                </div> -->

                <div formArrayName="options">
                    <div *ngFor="let option of fbForm.get('options')?.value; let i=index; trackBy:trackByFn">
                        <!-- Angular assigns array index as group name by default 0, 1, 2, ... -->
                        <div [formGroupName]="i" class="form-group">
                            <input type="hidden" formControlName="voteCount">
                            <input type="hidden" formArrayName="votesBy">
                            <input type="text" class="form-inline form-control" formControlName="name"
                                placeholder="Option">
                            <!-- Enable Remove button when more than 2 options exist -->
                            <span *ngIf="fbForm.get('options')!.value.length > minOptions">
                                <button type='button' class="btn btn-sm btn-secondary" (click)="removeOption(i)">
                                    <i class="zmdi zmdi-minus-square"></i> Remove</button>
                            </span>
                            <small>{{fbForm.get('options')!.value[i].name.value}}</small>
                            <span *ngIf="fbForm.get('options')!.value.length <= minOptions">
                                <button type='button' class="btn btn-sm btn-secondary disabled"> - </button>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="add-options text-right">
                    <button type='button' class="btn btn-sm btn-primary" (click)='addOption()'>+ Add Option</button>
                </div>

                <button type='button' class="btn btn-md btn-outline-success" type="submit" [disabled]="!fbForm.valid">
                    <span *ngIf="currentRoute === 'new'"><i class="zmdi zmdi-plus"></i> Create</span>
                    <span *ngIf="currentRoute === 'edit'"><i class="zmdi zmdi-floppy"> Update</i></span>
                </button>
            </form>
        </div>

        <div class="col-sm-6">
            <div *ngIf="!chartEmpty">
                <app-barchart [barChartLabels]="chartLabels" [barChartData]="chartData">
                    <i class="zmdi zmdi-spinner zmdi-blue zmdi-hc-spin"></i>
                </app-barchart>
            </div>
            <div class="text-center empty-chart" *ngIf="chartEmpty">
                <h4>Add options</h4>
                <h4>to generate a poll</h4>
            </div>
        </div>
    </div>
</div>